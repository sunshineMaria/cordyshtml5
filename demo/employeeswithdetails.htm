<!DOCTYPE html> 
<html> 
	<head> 
	<title>Employees</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"/> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js" type="text/javascript"></script>
	
	<script src="/cordys/html5/knockout/knockout-2.0.0.js" type="text/javascript"></script>	

	<script src="/cordys/html5/cordys.html5sdk-0.1.js" type="text/javascript"></script>

	<script type="text/javascript">
		var empModel;
		$(function() {
			empModel = new $.cordys.model({
				objectName: "Employees",
				defaults: {
					namespace: "http://schemas.cordys.com/NW",
					dataType: "json"
				},
				create: {},
				read: {
					method: "GetEmployeesObjects",
					parameters: [
						{name: "fromEmployeeID", value: "0"},
						{name: "toEmployeeID", value: "99"}
					],
					success : function(data) {
					//	alert(data.length + " records found");
					}
				},
				update: {
					method: "UpdateEmployees"
				},
				'delete': {}
			});
			ko.applyBindings(empModel);
			empModel.read();
		//	empModel.read({method:"GetEmployeesObjectsForEmployees", parameters: [{name:"ReportsTo", value:"2"}]});
		});

		function selectEmployee(emp) {
			return function(data) {
				if (empModel.selectedItem) empModel.selectedItem(data);
			}
		}
	</script>

</head> 

<body> 

	<div data-role="page" id="mainPage">
		<div data-role="header" data-theme="b">
			<a href="http://www.cordys.com" data-icon="home">Cordys</a>
			<h1>Employees</h1>
		</div>

		<div data-role="content" data-theme="b">
			<ul id="employeeList" data-role="listview" data-theme="c" data-inset="true" data-bind="foreach:Employees">
				<li>
					<div >
						<a href="#detailsPage" data-transition="pop" class="ui-link-inherit" data-bind="click:selectEmployee($data)">
							<img class="ui-li-thumb ui-corner-tl" data-bind="attr: {src: 'data:image/bmp;base64,' + Photo.substring(104) }"/>
							<h3 class="ui-li-heading"><span data-bind="text:FirstName"></span>&nbsp;<span data-bind="text:LastName"></span></h3>
							<p class="ui-li-desc" data-bind="text:Address"></p>
							<p class="ui-li-desc"><span data-bind="text:City"></span>&nbsp;<span data-bind="text:Country"></span></p>
						</a>
					</div>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="page" id="detailsPage">
		<div data-role="header" data-theme="b">
			<a href="#mainPage" data-role="button" data-icon="back" data-rel="back">Back</a>
			<h1>Employee Details</h1>
			<a data-role="button" id="btnEdit">Edit</a>
		</div>
		<div data-role="content" data-theme="b">
			<ul data-role="listview" id="detailView">
				<li>
					<div data-bind="with: selectedItem">
						<a class="ui-link-inherit">
							<img class="ui-li-thumb ui-corner-tl" data-bind="attr: {src: 'data:image/bmp;base64,' + Photo.substring(104) }"/>
							<h3 class="ui-li-heading"><span data-bind="text:TitleOfCourtesy"></span>&nbsp;<span data-bind="text:FirstName"></span>&nbsp;<span data-bind="text:LastName"></span></h3>
							<p class="ui-li-desc"><span data-bind="text:Title"></p>
						</a>
					</div>
				</li>
				<li data-role="fieldcontain">
					<div  data-bind="with: selectedItem">
						<div >
							<label for="fldPhone" class="ui-input-text">Phone</label>
							<input type="text" id="fldPhone" data-bind="value:HomePhone" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
						<div >
							<label for="fldAddress" class="ui-input-text">Address</label>
							<input type="text" id="fldAddress" data-bind="value:Address" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
						<div >
							<label for="fldCity" class="ui-input-text">City</label>
							<input type="text" id="fldCity" data-bind="value:City" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
						<div >
							<label for="fldCountry" class="ui-input-text">Country</label>
							<input type="text" id="fldCountry" data-bind="value:Country" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
						<div >
							<label for="fldNotes" class="ui-input-text">Notes</label>
							<textarea id="fldNotes" data-bind="value:Notes" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"></textarea>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</div>
<script type="text/javascript">
	$("#detailsPage").live('pageinit', function() {
		var inEdit = false;
		$("#btnEdit").bind("click", function() {
			if (inEdit) {
				$(".ui-btn-text", this).text("Edit");
				$("#detailView :input").attr('disabled','disabled');
			}
			else {
				$(".ui-btn-text", this).text("Completed");
				$("#detailView :input").removeAttr('disabled');
				$("#fldPhone").select().focus();
			}
			inEdit = !inEdit;
		});
	});
	$("#detailsPage").bind( 'pageshow',function(event, ui) {
		$("#btnEdit .ui-btn-text").text("Edit");
		$('#detailView').listview("refresh");
		$("#detailView :input").attr('disabled','disabled');
	});
</script>

</body>
</html>
