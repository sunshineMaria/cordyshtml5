<!DOCTYPE html>
<html>
	<head>
		<title>Expense Request</title>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
		<script src="http://code.jquery.com/jquery-1.7.1.min.js" type="text/javascript"></script>
		<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js" type="text/javascript"></script>

		<script src="/cordys/html5/cordys.mobile.js" type="text/javascript"></script>

	</head>

	<body>

		<div data-role="page" id="requestPage">
			<div data-role="header" data-theme="b">
				<h1>Expense</h1>
			</div>

			<div data-role="content" data-theme="b">
				<label for="fldName">
					Employee Name
				</label>
				<input id="fldName" placeholder="" value="" type="text" />
				<label for="fldReason">
					Reason
				</label>
				<input id="fldReason" placeholder="" value="" type="text" />
				<label for="fldAmount">
					Amount
				</label>
				<input id="fldAmount" placeholder="" value="" type="text" />
				<button id="btnSend" type="submit" data-theme="b">Send Request</button>
			</div>
		<script type="text/javascript">

			$("#requestPage")
				.on('pageinit', function() {
					$("#btnSend").bind("click", sendRequest);
					$(":input").bind("change", function() {
						$("#btnSend").button('enable');
					});
					$("#fldName").focus();
				})
				.keydown(function (event) {
					if (event.keyCode == 13) { // Enter
						$("#btnSend").trigger("click");
					}
				});

			function sendRequest() {
				$.cordys.ajax({
					method: "ExecuteProcess",
					namespace: "http://schemas.cordys.com/bpm/execution/1.0",
					dataType: 'json',
					parameters: [
						{name:"receiver",value:"Expense Request Model"},
						{name:"type",value:"definition"},
						{name:"source",value:"Mobile"},
						{name:"message", value: getInputMessage}
					],
					success: function(data) {
						$("#btnSend").button('disable');
					}
				});
			}

			function getInputMessage() {
				var inputMessage = "<ExpenseRequest xmlns='http://schemas.cordys.com/default'>\
										<Expense>\
											<EmployeeName>"+$("#fldName").val()+"</EmployeeName>\
											<Reason>"+$("#fldReason").val()+"</Reason>\
											<Amount>"+$("#fldAmount").val()+"</Amount>\
										</Expense>\
									</ExpenseRequest>";
				return inputMessage;
			}
		</script>
		</div>

	</body>
</html>
