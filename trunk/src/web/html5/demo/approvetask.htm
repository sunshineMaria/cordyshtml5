<!DOCTYPE html> 
<html> 
	<head> 
	<title>Approve</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"/> 
	<link rel="stylesheet" href="/cordys/html5/jquery/jquery.mobile-1.1.0.min.css" />
	<script src="/cordys/html5/jquery/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="/cordys/html5/jquery/jquery.mobile-1.1.0.min.js" type="text/javascript"></script>
	
	<script src="/cordys/html5/knockout/knockout-2.1.0.js" type="text/javascript"></script>	
	<script src="/cordys/html5/cordys.html5sdk-0.1.js" type="text/javascript"></script>

</head> 

<body> 

	<div data-role="page" id="approvePage">
		<div data-role="header" data-theme="b">
			<a id="btnBack" href="#mainPage" data-role="button" data-icon="back">Back</a>
			<h1>Approve</h1>
		</div>

		<div data-role="content" data-theme="b">
			<ul data-role="listview" data-inset="true" id="detailView" data-bind="foreach: Task">
				<li data-role="heading" data-theme="c" data-mini="true">
					<div>
						<a class="ui-link-inherit">
							<h3 class="ui-li-heading"><span data-bind="text:TaskData.ApplicationData.ApproveTask.header.text">Approve Task</span></h3>
						</a>
					</div>
				</li>
				<li data-role="fieldcontain" data-mini="true" id="identifierView">
					<div data-bind="foreach: $root.fields">
						<div >
							<label for="fldName" class="ui-input-text" data-bind="text:Description">Name</label>
							<input type="text" readonly='true' id="fldName" data-bind="value:Value" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
					</div>
				</li>
				<li data-role="fieldcontain" data-mini="true">
					<div data-role="controlgroup" data-type="horizontal" data-theme="d" data-bind="foreach: TaskData.ApplicationData.ApproveTask.options.option">
						<a data-role="button" data-theme="c" data-bind="click:completeTask"><span data-bind="text:$data['@label']"></span></a>
					</div>
				</li>
			</ul>
		</div>

		<script type="text/javascript">
			var taskDetailModel, bindingsApplied = false;
			$("#approvePage").bind( 'pageshow',function(event, ui) {
				taskDetailModel = $.cordys.workflow.getTaskDetails($.cordys.workflow.taskModel.selectedItem(), {
					success:function(tasks) {
					//	var pid = tasks[0].ProcessInstanceId;
						$.cordys.process.getBusinessIdentifiers(tasks[0], {
							success:function(identifiers) {
								taskDetailModel.fields(identifiers);
							}
						})
					}
				});
				taskDetailModel.fields = ko.observableArray();
				if (!bindingsApplied) {
					ko.applyBindings(taskDetailModel, document.getElementById("approvePage"));
					bindingsApplied = true;
				}
			});

			function completeTask(btnData) {
				$.cordys.workflow.completeTask(taskDetailModel.Task()[0], {
					ApproveTask_ApproveTaskDefaultDeliveryModel_OP: {
						'@xmlns': 'http://schemas.cordys.com/approve',
						response: btnData['@value']
					}
				});
				$("#btnBack").click();
			}

		</script>
	</div>

</body>
</html>
