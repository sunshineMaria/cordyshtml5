<!DOCTYPE html> 
<html> 
	<head> 
	<title>Create Order</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"/> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js" type="text/javascript"></script>
	
	<script src="/cordys/html5/knockout/knockout-2.1.0.js" type="text/javascript"></script>	
	<script src="/cordys/html5/cordys.html5sdk-0.1.js" type="text/javascript"></script>

	<script type="text/javascript">
		$(document).ready(function() {
			$(".numberField").focusout(function() {
				var $inputField = $(this).find(":input");
					if(!$.isNumeric($inputField.val())) {
					if($inputField.val() !== "") {
						$(this).find(".errorMessage").html("Digits Only").css("color","red").show().delay(500).fadeOut("slow");
						$inputField.focus();
						$inputField.val("");
					}
				}
			});
			$(".costField").focusout(function() {
				var quantity = parseInt($("#fldQuantity").val(),10);
				var price = parseInt($("#fldPrice").val(),10);
				var discount;
					if($("#fldDiscount").val() !== "") {
					discount = parseInt($("#fldPrice").val(),10) * parseInt($("#fldDiscount").val(),10) / 100;
				}else {
					discount = 0;
				}
				if(price !== undefined && quantity !== undefined) {
					var html = (price-discount)*quantity;
					html = Math.round(html).toFixed(2)
					if($.isNumeric(html)) {
						$("#fldCost").html(html); 
					}
				}
			});
		});
	</script>
</head> 
<body> 
	<div data-role="page" id="createFormPage">
		<div data-role="header" data-theme="b">
			<a id="btnBack" href="#mainPage" data-role="button" data-icon="back" data-rel="back" data-bind="click:revertChanges">Back</a>
			<h1>Create Order</h1>
		</div>
		<div data-role="content" data-theme="b">
			<ul data-role="listview" id="detailView">
				<li data-role="fieldcontain">
					<div id="orderDiv">
						<div class="field">
							<label for="fldCustomer" class="select">Customer</label>
							<select id="fldCustomer" class="right-align" data-native-menu="true" data-mini="true" data-theme="c" data-inline="true">
								<option value="0">--- Select ---</option>
							</select>
						</div>
						<div>
							<label for="fldEmployee" class="ui-input-text">Employee</label>
							<input type="text" id="fldEmployee" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
						<div>
							<label for="fldProduct" class="ui-input-text">Product</label>
							<input type="text" id="fldProduct" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
						</div>
						<div class="numberField costField">
							<label for="fldQuantity" class="ui-input-text">Quantity</label>
							<input type="text" id="fldQuantity" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
							<span class="errorMessage"></span>
						</div>
						<div class="numberField costField">
							<label for="fldPrice" class="ui-input-text">Price</label>
							<input type="text" id="fldPrice" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
							<span class="errorMessage"></span>
						</div>
						<div class="numberField"> 
							<label for="fldDiscount" class="ui-input-text">Discount</label>
							<input type="text" id="fldDiscount" class="ui-input-text ui-body-b ui-corner-all ui-shadow-inset"/>
							<span class="errorMessage"></span>
						</div>
						<div>
							<label for="fldCost" class="ui-input-text">Cost</label>
							<span id="fldCost"></span>
						</div>
						<div class="field">
						    <input type="button" id="fldCreateOrder" value="Create Order" class="ui-btn ui-body-b ui-corner-all ui-shadow-inset"/>
    					</div>
					</div>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="dialog" id="orderConfirmation">
		<div data-role="header" data-theme="b">
			<h1>Confirm Order</h1>
		</div>
		<div data-role="content" data-theme="b">
			<h4><span>The order is successfully registered.</span></h4>
			<a id="confirmOrderBtn" data-role="button" data-rel="back" data-inline="true" data-theme="b" href="#mainPage">Ok</a>
		</div>
	</div>
<script type="text/javascript">
	$(function(){
		$("#fldCreateOrder").bind("click", function () {
			$.cordys.process.startProcess("bpm/orderdemo", {
				OrderDemo: {
					'@xmlns': 'http://schemas.cordys.com/html5sdk/demo/1.0',
					Customer: $("#fldCustomer").val(),
					Employee: $("#fldEmployee").val(),
					Product: $("#fldProduct").val(),
					Quantity: $("#fldQuantity").val(),
					Discount: $("#fldDiscount").val(),
					Cost: $("#fldPrice").val()
				}
			}, {
				success: function () {
					$.mobile.changePage( "#orderConfirmation", { transition: "slideup"} );
				}
			});
		});
	});
</script>

</body>
</html>
